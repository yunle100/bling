<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>悬浮支付</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        html, body {
            height: 100%;
            overflow-x: hidden;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            position: relative;
        }
        
        /* 页面加载动画 */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent; /* 透明背景 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 主内容区域 - 初始隐藏 */
        .main-content {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .main-content.visible {
            opacity: 1;
        }
        
        /* 背景图容器 */
        .background-container {
            position: relative;
            width: 100%;
            min-height: 100%;
        }
        
        /* 背景图样式 */
        .background-image {
            width: 100%;
            height: auto;
            display: block;
            pointer-events: none; /* 禁止单独点开图片 */
        }
        
        /* 顶部轮播弹窗 */
        .top-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6); /* 更加透明的黑色背景 */
            border-radius: 10px;
            padding: 15px 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 999;
            max-width: 85%;
            text-align: center;
            color: white;
            animation: slideDown 0.5s ease-out;
            min-width: 300px;
        }
        
        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        .top-notification .user-name {
            color: #fff;
            font-weight: bold;
        }
        
        .top-notification .payment-info {
            color: #fff;
            font-size: 14px;
        }
        
        /* 长条悬浮支付按钮 */
        .floating-pay-button {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 22px 0;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.5), 
                        0 5px 15px rgba(0, 0, 0, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80%;
            max-width: 500px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            letter-spacing: 1px;
            animation: pulse 2s infinite;
            overflow: hidden;
        }
        
        /* 脉冲动画 */
        @keyframes pulse {
            0% {
                box-shadow: 0 15px 35px rgba(255, 107, 107, 0.5), 
                            0 5px 15px rgba(0, 0, 0, 0.3),
                            inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
            50% {
                box-shadow: 0 20px 45px rgba(255, 107, 107, 0.7), 
                            0 8px 25px rgba(0, 0, 0, 0.4),
                            inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
            100% {
                box-shadow: 0 15px 35px rgba(255, 107, 107, 0.5), 
                            0 5px 15px rgba(0, 0, 0, 0.3),
                            inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
        }
        
        /* 按钮悬停效果 */
        .floating-pay-button:hover {
            background: linear-gradient(135deg, #ff4757, #ff3742);
            transform: translateX(-50%) translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(255, 107, 107, 0.6), 
                        0 12px 30px rgba(0, 0, 0, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: none;
        }
        
        /* 按钮点击效果 */
        .floating-pay-button:active {
            transform: translateX(-50%) translateY(-2px) scale(0.98);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4), 
                        0 3px 10px rgba(0, 0, 0, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.1s ease;
        }
        
        /* 防止图片被长按保存 */
        .background-image {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* 移动端优化 */
        @media (max-width: 768px) {
            .floating-pay-button {
                padding: 20px 0;
                font-size: 20px;
                width: 80%;
            }
            
            .top-notification {
                max-width: 90%;
                padding: 12px 25px;
                min-width: 250px;
            }
            
            .loader {
                width: 50px;
                height: 50px;
            }
        }
        
        /* 超小屏幕优化 */
        @media (max-width: 360px) {
            .floating-pay-button {
                padding: 18px 0;
                font-size: 18px;
            }
            
            .top-notification {
                padding: 10px 20px;
                min-width: 200px;
            }
            
            .loader {
                width: 40px;
                height: 40px;
            }
        }
    </style>
    <!-- 引入FontAwesome图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- 引入 blueimp-md5 库 -->
    <script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script>
    <!-- 引入jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <!-- 页面加载动画 -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
    </div>
    
    <!-- 主内容区域 -->
    <div class="main-content" id="mainContent">
        <!-- 顶部轮播弹窗 -->
        <div id="topNotification" class="top-notification" style="display: none;">
            <span class="user-name" id="userName"></span>
            <span class="payment-info"> 刚刚支付了5.99元</span>
        </div>
        
        <!-- 背景图容器 -->
        <div class="background-container">
            <img src="https://img.alicdn.com/imgextra/i2/3994676485/O1CN01PQRPww1xmBa3HzbST_!!3994676485-0-ampmedia.jpg" 
                 alt="背景图" 
                 class="background-image"
                 id="backgroundImage">
        </div>
        
        <!-- 长条悬浮支付按钮 -->
        <button class="floating-pay-button" id="payButton">
            立即支付
        </button>
    </div>

    <script>
        // 加密配置信息
        const encryptedConfig = {
            pid: "MTA0NDQ=",
            key: "TEE1czROdHJrQm1LeFNZbkZQeEo=",
            apiUrl: "https://xarr.haofon.com/xpay/epay/submit.php",
            type: "wxpay",
            notify_url: "http://baidu.com",
            return_url: "http://bilibili.com",
            name: "男女表情包",
            money: "5.99",
            param: "",
            sign_type: "MD5"
        };

        // Base64解码函数
        function base64Decode(str) {
            try {
                // 标准Base64解码
                return decodeURIComponent(escape(atob(str)));
            } catch (e) {
                console.error('Base64解码失败:', e);
                return str; // 如果解码失败，返回原字符串
            }
        }

        // 获取解密后的配置
        function getDecryptedConfig() {
            return {
                apiUrl: encryptedConfig.apiUrl,
                pid: base64Decode(encryptedConfig.pid),
                key: base64Decode(encryptedConfig.key),
                type: encryptedConfig.type,
                notify_url: encryptedConfig.notify_url,
                return_url: encryptedConfig.return_url,
                name: encryptedConfig.name,
                money: encryptedConfig.money,
                param: encryptedConfig.param,
                sign_type: encryptedConfig.sign_type
            };
        }

        // 页面加载管理
        document.addEventListener('DOMContentLoaded', function() {
            const loadingScreen = document.getElementById('loadingScreen');
            const mainContent = document.getElementById('mainContent');
            const backgroundImage = document.getElementById('backgroundImage');
            
            // 等待背景图片加载完成
            if (backgroundImage.complete) {
                onImageLoaded();
            } else {
                backgroundImage.addEventListener('load', onImageLoaded);
                backgroundImage.addEventListener('error', onImageLoaded); // 即使出错也继续
            }
            
            // 设置最长等待时间（5秒）
            setTimeout(onImageLoaded, 5000);
            
            function onImageLoaded() {
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    mainContent.classList.add('visible');
                    
                    // 确保图片加载完成后调整容器高度
                    const img = document.querySelector('.background-image');
                    const container = document.querySelector('.background-container');
                    if (img && container) {
                        container.style.height = img.offsetHeight + 'px';
                    }
                }, 300);
            }
        });

        // 禁止缩放
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
        
        document.addEventListener('touchmove', function(e) {
            if(e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // 禁止图片长按保存
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // 用户名称数组
        var names = ["弘毅","李涛","豪哥","海阔天空","博文","小七","吴哥","丰富","格局","天天歌","三个七","晴天","黑羽","(宝ᴗ宝)"];
        var names_count = names.length;
        var names_i = 0;
        
        // 轮播显示用户支付信息
        function showUserPayment() {
            if(names_i == names_count-1){
                names_i = 0;
            }else{
                names_i = names_i + 1;
            }
            
            var tmp_name = names[names_i];
            $("#userName").text(tmp_name + "***");
            
            // 显示弹窗
            $("#topNotification").fadeIn(500);
            
            // 3秒后隐藏
            setTimeout(function(){
                $("#topNotification").fadeOut(500);
            }, 3000);
        }
        
        // 每3.5秒显示一次（包含显示和隐藏时间）
        setInterval(showUserPayment, 3500);
        
        // 页面加载后立即显示一次
        setTimeout(showUserPayment, 1000);

        // 生成随机订单号
        function generateOrderId() {
            return "order_" + Math.random().toString(36).substr(2, 9);
        }

        // 生成签名
        function generateSign(params, key) {
            // 1. 过滤掉 sign、sign_type 和空值
            const filteredParams = {};
            for (const [k, v] of Object.entries(params)) {
                if (k !== "sign" && k !== "sign_type" && v !== "" && v !== null && v !== undefined) {
                    filteredParams[k] = v;
                }
            }

            // 2. 按参数名 ASCII 码从小到大排序
            const sortedParams = Object.keys(filteredParams)
                .sort()
                .map(k => `${k}=${filteredParams[k]}`)
                .join("&");

            // 3. 拼接密钥并生成 MD5 签名
            const signStr = sortedParams + key;
            return md5(signStr).toLowerCase(); // MD5 结果为小写
        }

        // 发起支付请求（GET 方式）
        function initiatePayment() {
            // 获取解密后的配置
            const payConfig = getDecryptedConfig();
            
            const orderId = generateOrderId();
            const params = {
                pid: payConfig.pid,
                type: payConfig.type,
                out_trade_no: orderId,
                notify_url: payConfig.notify_url,
                return_url: payConfig.return_url,
                name: payConfig.name,
                money: payConfig.money,
                param: payConfig.param,
                sign_type: payConfig.sign_type,
            };
            const sign = generateSign(params, payConfig.key);
            params.sign = sign;

            // 拼接 URL 参数
            const queryParams = new URLSearchParams(params).toString();
            const paymentUrl = `${payConfig.apiUrl}?${queryParams}`;

            // 跳转到易支付页面
            window.location.href = paymentUrl;
        }

        // 绑定支付按钮点击事件
        document.getElementById("payButton").addEventListener("click", initiatePayment);
    </script>
</body>
</html>
